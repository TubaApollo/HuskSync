name: CI Tests

on:
  push:
    branches: [ 'master' ]
    paths-ignore:
      - 'docs/**'
      - 'workflows/**'
      - 'README.md'

permissions:
  contents: read
  checks: write

jobs:
  build:
    name: 'Build - 1.21.1'
    runs-on: ubuntu-latest
    steps:
      # ... (previous steps remain unchanged)

      - name: 'Create Release Draft '
        id: create_release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: v${{ env.version_name }}
          release_name: HuskSync v${{ env.version_name }}
          draft: true
          prerelease: false
      - name: 'Upload Release Assets '
        uses: actions/upload-artifact@v3
        with:
          name: HuskSync-${{ env.version_name }}-mc.1.21.1
          path: target/
          retention-days: 30
      - name: 'Publish Release '
        run: |
          curl \
          -X PATCH \
          https://api.github.com/repos/${{ github.repository }}/releases/${{ steps.create_release.outputs.release_id }} \
          -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
          -d '{"draft":false}'
